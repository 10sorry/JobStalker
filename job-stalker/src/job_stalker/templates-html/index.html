<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VACANCY SCANNER v2.03</title>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        /* ============== BASE RESET ============== */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            /* Единый шрифт для всего приложения */
            --font-main: 'Share Tech Mono', 'Consolas', 'Courier New', monospace;
            
            /* Размеры для 2K мониторов */
            --font-size-xs: 12px;
            --font-size-sm: 14px;
            --font-size-md: 16px;
            --font-size-lg: 18px;
            --font-size-xl: 20px;
            --font-size-xxl: 24px;
        }
        
        body {
            font-family: var(--font-main);
            font-size: var(--font-size-md);
            font-weight: 400;
            background: linear-gradient(135deg, #1a1d25, #252932, #1a1d25);
            min-height: 100vh;
            color: #7dff7d;
            overflow-x: hidden;
            letter-spacing: 0.5px;
        }
        
        /* ============== CHROME PANEL (Main Container) ============== */
        .chrome-panel {
            background: linear-gradient(180deg, #5a6070, #3a4250 50%, #2d333f);
            border-radius: 20px;
            padding: 4px;
            box-shadow: 
                0 8px 32px rgba(0,0,0,0.8),
                inset 0 1px 0 rgba(255,255,255,0.1);
        }
        
        .chrome-panel-middle {
            background: linear-gradient(180deg, #2d333f, #1a1d25);
            border-radius: 16px;
            padding: 4px;
        }
        
        .chrome-panel-inner {
            background: linear-gradient(180deg, #3a4250, #2d333f);
            border-radius: 14px;
            overflow: hidden;
            border: 4px solid;
            border-color: #5a6070 #1a1d25 #1a1d25 #5a6070;
        }
        
        /* ============== TITLE BAR ============== */
        .title-bar {
            background: linear-gradient(90deg, #4a5565, #3a4250 50%, #4a5565);
            padding: 12px 16px;
            border-bottom: 4px solid #1a1d25;
            position: relative;
            box-shadow: 
                inset 0 1px 0 rgba(255,255,255,0.1),
                0 2px 8px rgba(0,0,0,0.5);
        }
        
        .title-bar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, #7a8090 50%, transparent);
            opacity: 0.6;
        }
        
        .title-bar-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .title-leds {
            display: flex;
            gap: 4px;
            margin-right: 12px;
        }
        
        .led {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        
        .led.green {
            background: #7dff7d;
            box-shadow: 0 0 8px #7dff7d, inset 0 1px 1px rgba(255,255,255,0.5);
        }
        
        .led.orange {
            background: #f69029;
            box-shadow: 0 0 8px #f69029, inset 0 1px 1px rgba(255,255,255,0.5);
        }
        
        .led.blue {
            background: #4a9eff;
            box-shadow: 0 0 8px #4a9eff, inset 0 1px 1px rgba(255,255,255,0.5);
        }
        
        .title-text {
            color: #7dff7d;
            letter-spacing: 1px;
            font-size: var(--font-size-md);
            text-shadow: 0 0 8px rgba(125,255,125,0.5);
        }
        
        .window-controls {
            display: flex;
            gap: 8px;
        }
        
        .win-btn {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            border: 2px solid;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: var(--font-size-sm);
            font-weight: 400;
            transition: all 0.1s;
        }
        
        .win-btn.minimize {
            background: linear-gradient(180deg, #5a6070, #3a4250);
            border-color: #6a7080 #2a3040 #2a3040 #6a7080;
            color: #4a9eff;
        }
        
        .win-btn.close {
            background: linear-gradient(180deg, #8a4040, #6a3030);
            border-color: #9a5050 #5a2020 #5a2020 #9a5050;
            color: #ff6060;
        }
        
        .win-btn:hover { filter: brightness(1.2); }
        .win-btn:active { 
            border-color: #2a3040 #6a7080 #6a7080 #2a3040;
            transform: translateY(1px);
        }
        
        /* ============== CONTENT AREA ============== */
        .content-area {
            background: linear-gradient(135deg, #2d333f, #252932, #2d333f);
            padding: 20px;
            position: relative;
        }
        
        /* Noise texture */
        .content-area::before {
            content: '';
            position: absolute;
            inset: 0;
            opacity: 0.03;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
            pointer-events: none;
        }
        
        /* ============== LCD DISPLAY ============== */
        .lcd-panel {
            background: linear-gradient(180deg, #3a4250, #2d333f);
            padding: 4px;
            border-radius: 12px;
            border: 4px solid;
            border-color: #5a6070 #1a1d25 #1a1d25 #5a6070;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.5);
        }
        
        .lcd-screen {
            background: #0a1a0a;
            border-radius: 6px;
            padding: 20px;
            border: 2px solid #1a2a1a;
            position: relative;
            overflow: hidden;
        }
        
        /* Scanlines */
        .lcd-screen::before {
            content: '';
            position: absolute;
            inset: 0;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(125, 255, 125, 0.05) 2px,
                rgba(125, 255, 125, 0.05) 4px
            );
            pointer-events: none;
        }
        
        /* Glow */
        .lcd-screen::after {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(ellipse at center, rgba(125, 255, 125, 0.08), transparent 70%);
            pointer-events: none;
        }
        
        .lcd-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(125, 255, 125, 0.3);
            margin-bottom: 12px;
            position: relative;
            z-index: 1;
        }
        
        .lcd-title {
            font-family: var(--font-main);
            color: #7dff7d;
            letter-spacing: 1px;
            font-size: var(--font-size-md);
            text-shadow: 0 0 8px rgba(125, 255, 125, 0.8);
        }
        
        .lcd-time {
            font-family: var(--font-main);
            color: #7dff7d;
            opacity: 0.7;
            letter-spacing: 1px;
            font-size: var(--font-size-md);
        }
        
        .lcd-dots {
            display: flex;
            gap: 4px;
            margin-left: 12px;
        }
        
        .lcd-dot {
            width: 6px;
            height: 6px;
            background: #7dff7d;
            border-radius: 50%;
            box-shadow: 0 0 6px #7dff7d;
            animation: pulse 1s infinite;
        }
        
        .lcd-dot:nth-child(2) { animation-delay: 0.2s; }
        .lcd-dot:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }
        
        .lcd-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 12px;
            position: relative;
            z-index: 1;
        }
        
        .lcd-stat {
            display: flex;
            justify-content: space-between;
            font-family: var(--font-main);
            font-size: var(--font-size-md);
        }
        
        .lcd-stat-label { color: #7dff7d; opacity: 0.8; }
        .lcd-stat-value { text-shadow: 0 0 8px currentColor; font-weight: 400; }
        .lcd-stat-value.green { color: #7dff7d; }
        .lcd-stat-value.orange { color: #f69029; }
        .lcd-stat-value.blue { color: #4a9eff; }
        .lcd-stat-value.red { color: #ff4040; }
        
        .lcd-message {
            padding-top: 12px;
            border-top: 1px solid rgba(125, 255, 125, 0.3);
            font-family: var(--font-main);
            font-size: var(--font-size-sm);
            color: #7dff7d;
            opacity: 0.9;
            letter-spacing: 1px;
            position: relative;
            z-index: 1;
        }
        
        .lcd-message .cursor {
            animation: blink 0.5s infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }
        
        /* Progress bar in LCD */
        .lcd-progress {
            height: 12px;
            background: #0a1a0a;
            border: 1px solid rgba(125, 255, 125, 0.4);
            border-radius: 4px;
            margin-top: 12px;
            overflow: hidden;
            position: relative;
            z-index: 1;
        }
        
        .lcd-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #7dff7d, #4a9eff);
            box-shadow: 0 0 12px rgba(125, 255, 125, 0.6);
            transition: width 0.3s ease;
            position: relative;
        }
        
        .lcd-progress-bar::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shine 1.5s infinite;
        }
        
        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        /* ============== VU METER ============== */
        .vu-panel {
            background: linear-gradient(180deg, #3a4250, #2d333f);
            padding: 16px;
            border-radius: 12px;
            border: 4px solid;
            border-color: #5a6070 #1a1d25 #1a1d25 #5a6070;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.5);
        }
        
        .vu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .vu-title {
            color: #7dff7d;
            font-size: var(--font-size-sm);
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .vu-device {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            background: linear-gradient(180deg, #2a3a4a, #1a2a3a);
            border: 1px solid #3a5a6a;
            border-radius: 4px;
            padding: 2px 6px;
            font-size: var(--font-size-xs);
            color: #4a9eff;
        }
        
        .vu-device.gpu {
            background: linear-gradient(180deg, #2a4a3a, #1a3a2a);
            border-color: #3a6a5a;
            color: #7dff7d;
        }
        
        .vu-device-icon {
            font-size: var(--font-size-sm);
        }
        
        .vu-value {
            font-family: var(--font-main);
            color: #f69029;
            font-size: var(--font-size-md);
            font-weight: 400;
        }
        
        .vu-track {
            background: linear-gradient(180deg, #0a0d15, #151820);
            border-radius: 8px;
            padding: 12px;
            border: 2px solid #2d333f;
            box-shadow: inset 0 4px 12px rgba(0,0,0,0.9);
            position: relative;
        }
        
        .vu-segments-wrapper {
            position: relative;
        }
        
        .vu-segments {
            display: flex;
            gap: 4px;
            height: 28px;
            position: relative;
        }
        
        .vu-segment {
            flex: 1;
            border-radius: 3px;
            background: #1a2018;
            border: 1px solid #0a0d08;
            transition: none; /* Убираем задержку! */
            position: relative;
            overflow: hidden;
        }
        
        .vu-segment.green { background: #1a2a18; border-color: #0a150a; }
        .vu-segment.yellow { background: #2a2818; border-color: #15140a; }
        .vu-segment.red { background: #2a1818; border-color: #150a0a; }
        
        .vu-segment.active.green { 
            background: linear-gradient(180deg, #a0ffa0, #7dff7d, #50d050); 
            border-color: #409040;
            box-shadow: 0 0 10px rgba(125, 255, 125, 0.6);
        }
        .vu-segment.active.yellow { 
            background: linear-gradient(180deg, #ffe060, #e0c040, #c0a030); 
            border-color: #908030;
            box-shadow: 0 0 10px rgba(240, 200, 60, 0.6);
        }
        .vu-segment.active.red { 
            background: linear-gradient(180deg, #ff7070, #ff4040, #c03030); 
            border-color: #903030;
            box-shadow: 0 0 10px rgba(255, 64, 64, 0.6);
        }
        
        /* Needle - тонкая длинная палочка как в Figma */
        .vu-needle {
            position: absolute;
            top: -4px;
            bottom: -4px;
            width: 2px;
            background: linear-gradient(180deg, 
                rgba(255,255,255,0.5),
                rgba(255,255,255,0.95), 
                rgba(255,255,255,0.95),
                rgba(255,255,255,0.5));
            border-radius: 1px;
            box-shadow: 
                0 0 6px rgba(255, 255, 255, 0.9),
                0 0 12px rgba(255, 255, 255, 0.4);
            z-index: 10;
            pointer-events: none;
            left: 0;
            /* Без transition - мгновенное перемещение */
        }
        
        .vu-scale {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            padding: 0 4px;
        }
        
        .vu-scale span {
            font-family: var(--font-main);
            font-size: var(--font-size-xs);
            opacity: 0.7;
        }
        
        .vu-scale .green { color: #7dff7d; }
        .vu-scale .yellow { color: #e0c040; }
        .vu-scale .red { color: #ff4040; }
        
        /* ============== CONTROL PANEL ============== */
        .control-panel {
            background: linear-gradient(180deg, #3a4250, #2d333f);
            padding: 16px;
            border-radius: 12px;
            border: 4px solid;
            border-color: #5a6070 #1a1d25 #1a1d25 #5a6070;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.5);
        }
        
        .panel-title {
            color: #7dff7d;
            font-size: var(--font-size-sm);
            letter-spacing: 1px;
            margin-bottom: 12px;
        }
        
        .control-buttons {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        /* ============== CONTROL BUTTON ============== */
        .ctrl-btn {
            position: relative;
            padding: 14px 16px;
            background: linear-gradient(180deg, #5a6070, #3a4250);
            border: 4px solid;
            border-color: #6a7080 #2a3040 #2a3040 #6a7080;
            border-radius: 8px;
            cursor: pointer;
            color: #7dff7d;
            font-size: var(--font-size-md);
            letter-spacing: 1px;
            text-align: center;
            transition: all 0.1s;
            box-shadow: 
                inset 0 1px 0 rgba(255,255,255,0.1),
                0 4px 0 rgba(0,0,0,0.3);
        }
        
        .ctrl-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, transparent, #7a8090 50%, transparent);
            opacity: 0.6;
            border-radius: 4px 4px 0 0;
        }
        
        .ctrl-btn:hover {
            background: linear-gradient(180deg, #6a7080, #4a5260);
        }
        
        .ctrl-btn:active {
            background: linear-gradient(180deg, #2d333f, #3a4250);
            border-color: #1a1d25 #5a6070 #5a6070 #1a1d25;
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.8);
            transform: translateY(2px);
        }
        
        .ctrl-btn:active::before { display: none; }
        
        .ctrl-btn.active {
            background: linear-gradient(180deg, #3a6040, #2a4530);
            border-color: #5a8060 #1a2510 #1a2510 #5a8060;
            color: #7dff7d;
            box-shadow: 
                inset 0 1px 0 rgba(255,255,255,0.1),
                0 0 12px rgba(125, 255, 125, 0.3);
        }
        
        .ctrl-btn.danger {
            color: #ff6060;
        }
        
        .ctrl-btn.danger:hover {
            background: linear-gradient(180deg, #6a4040, #4a3030);
        }
        
        .ctrl-btn-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .ctrl-btn-icon {
            color: #4a9eff;
        }
        
        /* LED indicators on button */
        .ctrl-btn-leds {
            position: absolute;
            left: 8px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .ctrl-btn-led {
            width: 4px;
            height: 4px;
            border-radius: 50%;
        }
        
        .ctrl-btn-led.green { background: #7dff7d; box-shadow: 0 0 4px #7dff7d; }
        .ctrl-btn-led.orange { background: #f69029; box-shadow: 0 0 4px #f69029; }
        
        /* Corner decorations */
        .ctrl-btn-corner {
            position: absolute;
            width: 8px;
            height: 8px;
            border: 2px solid #4a9eff;
            opacity: 0.4;
        }
        
        .ctrl-btn-corner.tl { top: 4px; left: 4px; border-right: none; border-bottom: none; }
        .ctrl-btn-corner.tr { top: 4px; right: 4px; border-left: none; border-bottom: none; }
        .ctrl-btn-corner.bl { bottom: 4px; left: 4px; border-right: none; border-top: none; }
        .ctrl-btn-corner.br { bottom: 4px; right: 4px; border-left: none; border-top: none; }
        
        /* ============== RESUME DISK SLOT ============== */
        .disk-slot-panel {
            background: linear-gradient(180deg, #3a4250, #2d333f);
            padding: 16px;
            border-radius: 12px;
            border: 4px solid;
            border-color: #5a6070 #1a1d25 #1a1d25 #5a6070;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.5);
        }
        
        .disk-slot {
            background: #1a1d25;
            border-radius: 8px;
            padding: 16px;
            border: 2px solid #2d333f;
            box-shadow: inset 0 4px 12px rgba(0,0,0,0.8);
        }
        
        .disk-opening {
            background: linear-gradient(180deg, #0a0d15, #1a1d25);
            height: 70px;
            border-radius: 6px;
            border: 2px solid #2d333f;
            position: relative;
            overflow: hidden;
            margin-bottom: 12px;
            cursor: pointer;
        }
        
        /* Slot guides */
        .disk-opening::before,
        .disk-opening::after {
            content: '';
            position: absolute;
            top: 8px;
            bottom: 8px;
            width: 4px;
            background: linear-gradient(180deg, #2d333f, #1a1d25);
        }
        
        .disk-opening::before { left: 8px; }
        .disk-opening::after { right: 8px; }
        
        .disk-empty {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #2d333f;
            font-size: var(--font-size-sm);
            letter-spacing: 1px;
            opacity: 0.5;
        }
        
        /* Cassette animation */
        .disk-cassette {
            position: absolute;
            left: 16px;
            right: 16px;
            top: 50%;
            height: 50px;
            background: linear-gradient(135deg, #5a6070, #3a4250, #2d333f);
            border-radius: 6px;
            border: 2px solid #4a5260;
            box-shadow: 0 2px 8px rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            padding: 0 12px;
            gap: 10px;
            transform: translateY(-150%);
            opacity: 0;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .disk-cassette.inserting {
            animation: insertCassette 0.8s ease-out forwards;
        }
        
        .disk-cassette.inserted {
            transform: translateY(-50%);
            opacity: 1;
        }
        
        .disk-cassette.ejecting {
            animation: ejectCassette 0.6s ease-in forwards;
        }
        
        @keyframes insertCassette {
            0% { transform: translateY(-200%); opacity: 0; }
            30% { transform: translateY(-120%); opacity: 0.5; }
            60% { transform: translateY(-40%); opacity: 1; }
            80% { transform: translateY(-55%); opacity: 1; }
            100% { transform: translateY(-50%); opacity: 1; }
        }
        
        @keyframes ejectCassette {
            0% { transform: translateY(-50%); opacity: 1; }
            30% { transform: translateY(-60%); opacity: 1; }
            100% { transform: translateY(-200%); opacity: 0; }
        }
        
        .cassette-icon { 
            font-size: var(--font-size-xxl); 
            filter: drop-shadow(0 0 4px #4a9eff);
        }
        
        .cassette-label {
            flex: 1;
            background: #1a1d25;
            border-radius: 3px;
            padding: 4px 8px;
            border: 1px solid #2d333f;
        }
        
        .cassette-name {
            font-family: var(--font-main);
            font-size: var(--font-size-xs);
            color: #7dff7d;
            letter-spacing: 1px;
        }
        
        .cassette-size {
            font-family: var(--font-main);
            font-size: var(--font-size-xs);
            color: #4a9eff;
        }
        
        .cassette-check { 
            color: #7dff7d; 
            font-size: var(--font-size-lg);
            text-shadow: 0 0 8px #7dff7d;
        }
        
        /* Resume Info Card */
        .resume-info-card {
            background: linear-gradient(180deg, #1a2a1a, #0a1a0a);
            border: 2px solid #2a4a2a;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
            display: none;
        }
        
        .resume-info-card.active { display: block; }
        
        .resume-info-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid #2a4a2a;
        }
        
        .resume-info-avatar {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #3a6040, #2a4530);
            border: 2px solid #5a8060;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--font-size-xl);
        }
        
        .resume-info-name {
            flex: 1;
        }
        
        .resume-info-name h4 {
            color: #7dff7d;
            font-size: var(--font-size-md);
            margin: 0 0 2px 0;
            text-shadow: 0 0 6px rgba(125, 255, 125, 0.5);
        }
        
        .resume-info-name p {
            color: #4a9eff;
            font-size: var(--font-size-sm);
            margin: 0;
            font-family: var(--font-main);
        }
        
        .resume-info-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 10px;
        }
        
        .resume-stat {
            background: #0a1a0a;
            border: 1px solid #2a4a2a;
            border-radius: 4px;
            padding: 6px 8px;
            text-align: center;
        }
        
        .resume-stat-value {
            font-family: var(--font-main);
            font-size: var(--font-size-md);
            color: #f69029;
            text-shadow: 0 0 6px rgba(246, 144, 41, 0.5);
        }
        
        .resume-stat-label {
            font-size: var(--font-size-xs);
            color: #7dff7d;
            opacity: 0.7;
            letter-spacing: 1px;
        }
        
        .resume-skills {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }
        
        .resume-skill-tag {
            background: linear-gradient(180deg, #2a4a2a, #1a3a1a);
            border: 1px solid #3a5a3a;
            border-radius: 10px;
            padding: 3px 8px;
            font-size: var(--font-size-xs);
            color: #7dff7d;
        }
        
        .disk-leds {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .disk-led {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .disk-led-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #2d333f;
            transition: all 0.3s;
        }
        
        .disk-led-dot.active.green { background: #7dff7d; box-shadow: 0 0 8px #7dff7d; }
        .disk-led-dot.active.orange { background: #f69029; box-shadow: 0 0 8px #f69029; animation: pulse 0.5s infinite; }
        
        .disk-led-label {
            font-size: var(--font-size-sm);
            opacity: 0.6;
        }
        
        .disk-led-label.green { color: #7dff7d; }
        .disk-led-label.orange { color: #f69029; }
        
        .disk-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }
        
        .disk-btn {
            padding: 10px;
            font-size: var(--font-size-sm);
            letter-spacing: 1px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.1s;
            text-align: center;
        }
        
        .disk-btn.insert {
            background: linear-gradient(180deg, #4a5565, #3a4250);
            border: 3px solid;
            border-color: #5a6570 #2a3040 #2a3040 #5a6570;
            color: #7dff7d;
        }
        
        .disk-btn.eject {
            background: linear-gradient(180deg, #4a5565, #3a4250);
            border: 3px solid;
            border-color: #5a6570 #2a3040 #2a3040 #5a6570;
            color: #f69029;
        }
        
        .disk-btn:hover { filter: brightness(1.1); }
        .disk-btn:active { 
            border-color: #2a3040 #5a6570 #5a6570 #2a3040;
            transform: translateY(1px);
        }
        
        .disk-btn:disabled {
            background: #2d333f;
            border-color: #3a4250;
            color: #5a6070;
            cursor: not-allowed;
        }
        
        .disk-hint {
            margin-top: 12px;
            text-align: center;
            font-family: var(--font-main);
            font-size: var(--font-size-sm);
            color: #7dff7d;
            opacity: 0.5;
            letter-spacing: 1px;
        }
        
        /* ============== STATS PANEL ============== */
        .stats-panel {
            background: linear-gradient(180deg, #3a4250, #2d333f);
            padding: 16px;
            border-radius: 12px;
            border: 4px solid;
            border-color: #5a6070 #1a1d25 #1a1d25 #5a6070;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.5);
        }
        
        .stats-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #1a1d25;
            padding: 10px 12px;
            border-radius: 6px;
            border: 2px solid #2d333f;
        }
        
        .stat-item-left {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .stat-item-icon { color: #4a9eff; font-size: var(--font-size-lg); }
        .stat-item-label { color: #7dff7d; font-size: var(--font-size-sm); }
        .stat-item-value { color: #f69029; font-size: var(--font-size-lg); font-weight: 400; }
        
        /* ============== VACANCY CARDS ============== */
        .vacancy-section {
            margin-top: 20px;
        }
        
        .vacancy-header {
            background: linear-gradient(90deg, #2d333f, #3a4250, #2d333f);
            padding: 10px 16px;
            border-radius: 8px 8px 0 0;
            border: 4px solid;
            border-color: #5a6070 #1a1d25 transparent #5a6070;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .vacancy-header-dot {
            width: 8px;
            height: 8px;
            background: #f69029;
            border-radius: 50%;
            box-shadow: 0 0 8px #f69029;
            animation: pulse 1s infinite;
        }
        
        .vacancy-header-text {
            color: #f69029;
            font-size: var(--font-size-sm);
            letter-spacing: 1px;
        }
        
        .vacancies-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 16px;
            padding-top: 16px;
        }
        
        .vacancy-card {
            background: linear-gradient(180deg, #3a4250, #2d333f);
            border-radius: 12px;
            border: 4px solid;
            border-color: #5a6070 #1a1d25 #1a1d25 #5a6070;
            overflow: hidden;
            box-shadow: 0 4px 16px rgba(0,0,0,0.5);
            transition: all 0.3s;
        }
        
        .vacancy-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.6);
        }
        
        .vacancy-card-header {
            background: linear-gradient(90deg, #2d333f, #3a4250, #2d333f);
            padding: 10px 12px;
            border-bottom: 2px solid #1a1d25;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }
        
        .vacancy-card-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, #5a6070 50%, transparent);
        }
        
        .vacancy-card-id {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .vacancy-card-led {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 1s infinite;
        }
        
        .vacancy-card-led.active { background: #7dff7d; box-shadow: 0 0 6px #7dff7d; }
        .vacancy-card-led.pending { background: #f6d029; box-shadow: 0 0 6px #f6d029; }
        .vacancy-card-led.archived { background: #666; }
        
        .vacancy-card-code {
            font-family: var(--font-main);
            font-size: var(--font-size-sm);
            color: #4a9eff;
            letter-spacing: 1px;
        }
        
        .vacancy-card-status {
            font-size: var(--font-size-sm);
            letter-spacing: 1px;
            color: #7dff7d;
            text-transform: uppercase;
        }
        
        .vacancy-card-body {
            padding: 16px;
        }
        
        .vacancy-card-title {
            color: #f69029;
            font-size: var(--font-size-lg);
            margin-bottom: 4px;
            line-height: 1.3;
        }
        
        .vacancy-card-company {
            color: #7dff7d;
            font-size: var(--font-size-md);
            opacity: 0.8;
            margin-bottom: 12px;
        }
        
        .vacancy-card-details {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-bottom: 12px;
        }
        
        .vacancy-card-detail {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: var(--font-size-sm);
        }
        
        .vacancy-card-detail-icon { color: #4a9eff; font-size: var(--font-size-md); }
        .vacancy-card-detail-text { color: #7dff7d; opacity: 0.8; }
        
        /* Match meter */
        .match-meter {
            background: #1a1d25;
            border-radius: 8px;
            padding: 12px;
            border: 2px solid #2d333f;
        }
        
        .match-meter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .match-meter-label {
            display: flex;
            align-items: center;
            gap: 6px;
            color: #7dff7d;
            font-size: var(--font-size-sm);
        }
        
        .match-meter-icon { color: #4a9eff; font-size: var(--font-size-md); }
        
        .match-meter-value {
            font-size: var(--font-size-lg);
            letter-spacing: 1px;
            text-shadow: 0 0 8px currentColor;
            font-weight: 400;
        }
        
        .match-meter-value.high { color: #7dff7d; }
        .match-meter-value.medium { color: #f6d029; }
        .match-meter-value.low { color: #f69029; }
        .match-meter-value.none { color: #5a6070; text-shadow: none; }
        
        .match-meter.pending .match-meter-bar { display: none; }
        
        .match-meter-hint {
            font-size: var(--font-size-xs);
            color: #4a9eff;
            opacity: 0.7;
            margin-top: 4px;
        }
        
        .match-meter-bar {
            height: 8px;
            background: #0a0d15;
            border-radius: 4px;
            overflow: hidden;
            border: 1px solid #2d333f;
        }
        
        .match-meter-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s;
            position: relative;
        }
        
        .match-meter-fill.high { background: #7dff7d; box-shadow: 0 0 8px #7dff7d; }
        .match-meter-fill.medium { background: #f6d029; box-shadow: 0 0 8px #f6d029; }
        .match-meter-fill.low { background: #f69029; box-shadow: 0 0 8px #f69029; }
        
        .match-meter-fill::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
        }
        
        .vacancy-card-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 12px;
        }
        
        .vacancy-btn {
            padding: 10px;
            background: linear-gradient(180deg, #4a5565, #3a4250);
            border: 3px solid;
            border-color: #5a6570 #2a3040 #2a3040 #5a6570;
            border-radius: 6px;
            font-size: var(--font-size-sm);
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.1s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        
        .vacancy-btn.details { color: #7dff7d; }
        .vacancy-btn.open { color: #f69029; }
        
        .vacancy-btn:hover { filter: brightness(1.1); }
        .vacancy-btn:active {
            border-color: #2a3040 #5a6570 #5a6570 #2a3040;
            transform: translateY(1px);
        }
        
        .vacancy-card-footer {
            height: 4px;
            background: linear-gradient(90deg, #2d333f, #5a6070 50%, #2d333f);
        }
        
        /* ============== EMPTY STATE ============== */
        .empty-state {
            text-align: center;
            padding: 40px;
            background: linear-gradient(180deg, #1a1d25, #0a0d15);
            border: 2px dashed #3a4250;
            border-radius: 12px;
        }
        
        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 12px;
            filter: grayscale(0.5);
        }
        
        .empty-state-text {
            font-size: var(--font-size-md);
            color: #5a6070;
            letter-spacing: 1px;
        }
        
        .vacancy-header-text {
            color: #f69029;
            font-size: var(--font-size-md);
            letter-spacing: 1px;
        }
        
        /* ============== MODAL ============== */
        .modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(4px);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal-backdrop.active { display: flex; }
        
        .modal-window {
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow: hidden;
        }
        
        .modal-tabs {
            background: linear-gradient(180deg, #2d333f, #252932);
            padding: 8px 16px;
            border-bottom: 2px solid #1a1d25;
            display: flex;
            gap: 8px;
        }
        
        .modal-tab {
            padding: 10px 16px;
            font-size: var(--font-size-sm);
            letter-spacing: 1px;
            border-radius: 6px 6px 0 0;
            cursor: pointer;
            transition: all 0.2s;
            background: #2d333f;
            border: 2px solid #3a4250;
            color: #5a6070;
        }
        
        .modal-tab:hover { color: #7dff7d; background: #3a4250; }
        
        .modal-tab.active {
            background: linear-gradient(180deg, #5a6070, #3a4250);
            border-color: #6a7080 #2a3040 transparent #6a7080;
            color: #7dff7d;
            box-shadow: inset 0 1px 0 rgba(255,255,255,0.1);
        }
        
        .modal-body {
            background: linear-gradient(135deg, #2d333f, #252932, #2d333f);
            padding: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }
        
        .modal-body::-webkit-scrollbar {
            width: 12px;
        }
        
        .modal-body::-webkit-scrollbar-track {
            background: #0a0d15;
            border: 1px solid #2d333f;
        }
        
        .modal-body::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #4a5568, #3a4250);
            border: 1px solid #6b7280;
            border-radius: 2px;
        }
        
        .modal-actions {
            background: linear-gradient(90deg, #2d333f, #3a4250, #2d333f);
            padding: 16px 20px;
            border-top: 4px solid #1a1d25;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }
        
        .modal-btn {
            padding: 10px 24px;
            background: linear-gradient(180deg, #4a5565, #3a4250);
            border: 3px solid;
            border-color: #5a6570 #2a3040 #2a3040 #5a6570;
            border-radius: 6px;
            font-size: var(--font-size-sm);
            letter-spacing: 1px;
            cursor: pointer;
            color: #7dff7d;
            transition: all 0.1s;
        }
        
        .modal-btn:hover { filter: brightness(1.1); }
        .modal-btn:active {
            border-color: #2a3040 #5a6570 #5a6570 #2a3040;
            transform: translateY(1px);
        }
        
        .modal-btn.primary {
            background: linear-gradient(180deg, #6a7040, #4a5030);
            border-color: #7a8050 #3a4020 #3a4020 #7a8050;
            box-shadow: 0 0 12px rgba(125, 255, 125, 0.3);
        }
        
        /* Tab content */
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        /* Resume comparison */
        .resume-compare {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }
        
        @media (max-width: 700px) {
            .resume-compare { grid-template-columns: 1fr; }
        }
        
        .resume-column {
            background: #0a0d15;
            border: 2px solid;
            border-color: #1a1d25 #3a4250 #3a4250 #1a1d25;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .resume-column-header {
            padding: 12px;
            background: linear-gradient(180deg, #2d333f, #1e222a);
            border-bottom: 1px solid #3a4250;
            font-size: var(--font-size-sm);
            font-weight: 400;
            letter-spacing: 1px;
        }
        
        .resume-column.original .resume-column-header { color: #8b94a3; }
        .resume-column.improved .resume-column-header { color: #7dff7d; }
        
        .resume-column-body {
            padding: 16px;
            font-family: var(--font-main);
            font-size: var(--font-size-sm);
            color: #c0c8d0;
            line-height: 1.6;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        
        /* Stream output */
        .stream-output {
            background: #0a0d15;
            border: 2px solid;
            border-color: #1a1d25 #3a4250 #3a4250 #1a1d25;
            border-radius: 6px;
            padding: 16px;
            font-family: var(--font-main);
            font-size: var(--font-size-sm);
            color: #7dff7d;
            max-height: 150px;
            overflow-y: auto;
            display: none;
            margin-bottom: 16px;
        }
        
        .stream-output.active { display: block; }
        
        /* ============== FORM ELEMENTS ============== */
        .form-row {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .form-group {
            flex: 1;
        }
        
        .form-label {
            display: block;
            font-size: var(--font-size-sm);
            color: #7dff7d;
            letter-spacing: 1px;
            margin-bottom: 6px;
        }
        
        .form-select, .form-input {
            width: 100%;
            padding: 10px 12px;
            background: #0a0d15;
            border: 2px solid;
            border-color: #1a1d25 #3a4250 #3a4250 #1a1d25;
            border-radius: 6px;
            color: #c0c8d0;
            font-family: var(--font-main);
            font-size: var(--font-size-md);
        }
        
        .form-select:focus, .form-input:focus {
            outline: none;
            border-color: #4a9eff;
        }
        
        .form-select option {
            background: #1a1d25;
            color: #c0c8d0;
        }
        
        .prompt-hint {
            font-size: var(--font-size-xs);
            color: #4a9eff;
            margin-bottom: 8px;
            opacity: 0.8;
        }
        
        .prompt-area {
            width: 100%;
            min-height: 140px;
            padding: 12px;
            background: #0a0d15;
            border: 2px solid;
            border-color: #1a1d25 #3a4250 #3a4250 #1a1d25;
            border-radius: 6px;
            color: #7dff7d;
            font-family: var(--font-main);
            font-size: var(--font-size-sm);
            resize: vertical;
            line-height: 1.5;
        }
        
        .prompt-area::placeholder { color: #3a4250; }
        .prompt-area:focus { outline: none; border-color: #4a9eff; }
        
        /* ============== LAYOUT ============== */
        .app-container {
            padding: 24px;
            max-width: 1800px;
            margin: 0 auto;
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 480px;
            gap: 20px;
        }
        
        @media (max-width: 1200px) {
            .main-grid { grid-template-columns: 1fr 420px; }
        }
        
        @media (max-width: 1000px) {
            .main-grid { grid-template-columns: 1fr; }
        }
        
        .left-column {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .right-column {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        /* Hidden file input */
        .hidden-input { display: none; }
    </style>
</head>
<body>
    <!-- Подключаем модуль авторизации -->
    <div class="app-container">
        <div class="chrome-panel">
            <div class="chrome-panel-middle">
                <div class="chrome-panel-inner">
                    <!-- Title Bar -->
                    <div class="title-bar">
                        <div class="title-bar-content">
                            <div style="display: flex; align-items: center;">
                                <div class="title-leds">
                                    <div class="led green"></div>
                                    <div class="led orange"></div>
                                </div>
                                <span class="title-text">VACANCY SCANNER v2.03</span>
                            </div>
                            <div class="window-controls">
                                <button class="win-btn minimize">_</button>
                                <button class="win-btn close">×</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Content -->
                    <div class="content-area">
                        <div class="main-grid">
                            <!-- Left Column -->
                            <div class="left-column">
                                <!-- LCD Display -->
                                <div class="lcd-panel">
                                    <div class="lcd-screen">
                                        <div class="lcd-header">
                                            <div style="display: flex; align-items: center;">
                                                <span class="lcd-title">VACANCY.SYS</span>
                                                <div class="lcd-dots" id="scanningDots" style="display: none;">
                                                    <div class="lcd-dot"></div>
                                                    <div class="lcd-dot"></div>
                                                    <div class="lcd-dot"></div>
                                                </div>
                                            </div>
                                            <span class="lcd-time" id="lcdTime">00:00:00</span>
                                        </div>
                                        
                                        <div class="lcd-stats">
                                            <div class="lcd-stat">
                                                <span class="lcd-stat-label">STATUS:</span>
                                                <span class="lcd-stat-value green" id="lcdStatus">IDLE</span>
                                            </div>
                                            <div class="lcd-stat">
                                                <span class="lcd-stat-label">FOUND:</span>
                                                <span class="lcd-stat-value orange" id="lcdFound">000</span>
                                            </div>
                                            <div class="lcd-stat">
                                                <span class="lcd-stat-label">PROCESSED:</span>
                                                <span class="lcd-stat-value blue" id="lcdProcessed">000</span>
                                            </div>
                                            <div class="lcd-stat">
                                                <span class="lcd-stat-label">REJECTED:</span>
                                                <span class="lcd-stat-value red" id="lcdRejected">000</span>
                                            </div>
                                        </div>
                                        
                                        <div class="lcd-message">
                                            <span class="cursor">▸</span>
                                            <span id="lcdMessage">SYSTEM READY :: AWAITING INPUT</span>
                                        </div>
                                        
                                        <div class="lcd-progress" id="progressContainer" style="display: none;">
                                            <div class="lcd-progress-bar" id="progressBar" style="width: 0%;"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- VU Meter -->
                                <div class="vu-panel">
                                    <div class="vu-header">
                                        <span class="vu-title">
                                            LOAD METER
                                            <span class="vu-device" id="vuDevice">
                                                <span class="vu-device-icon">💻</span>
                                                <span id="vuDeviceName">CPU</span>
                                            </span>
                                        </span>
                                        <span class="vu-value" id="vuValue">0%</span>
                                    </div>
                                    <div class="vu-track">
                                        <div class="vu-segments-wrapper">
                                            <div class="vu-segments" id="vuSegments"></div>
                                            <div class="vu-needle" id="vuNeedle"></div>
                                        </div>
                                        <div class="vu-scale">
                                            <span class="green">0</span>
                                            <span class="yellow">60</span>
                                            <span class="red">85</span>
                                            <span class="red">100</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Vacancies Section -->
                                <div class="vacancy-section">
                                    <div class="vacancy-header">
                                        <div class="vacancy-header-dot"></div>
                                        <span class="vacancy-header-text">VACANCY DATABASE :: <span id="vacancyCount">0</span> RECORDS FOUND</span>
                                    </div>
                                    
                                    <div class="vacancies-grid" id="vacanciesGrid">
                                        <div class="empty-state">
                                            <div class="empty-state-icon">📡</div>
                                            <div class="empty-state-text">AWAITING SIGNAL...<br>PRESS SCAN TO BEGIN</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Right Column -->
                            <div class="right-column">
                                <!-- Control Panel -->
                                <div class="control-panel">
                                    <div class="panel-title">CONTROL PANEL</div>
                                    <div class="control-buttons">
                                        <button class="ctrl-btn" id="scanBtn" onclick="toggleScan()">
                                            <div class="ctrl-btn-leds">
                                                <div class="ctrl-btn-led green"></div>
                                                <div class="ctrl-btn-led orange"></div>
                                            </div>
                                            <div class="ctrl-btn-content">
                                                <span class="ctrl-btn-icon">▶</span>
                                                <span>SCAN</span>
                                            </div>
                                            <div class="ctrl-btn-corner tl"></div>
                                            <div class="ctrl-btn-corner tr"></div>
                                            <div class="ctrl-btn-corner bl"></div>
                                            <div class="ctrl-btn-corner br"></div>
                                        </button>
                                        
                                        <button class="ctrl-btn" onclick="openSettings()">
                                            <div class="ctrl-btn-leds">
                                                <div class="ctrl-btn-led green"></div>
                                                <div class="ctrl-btn-led orange"></div>
                                            </div>
                                            <div class="ctrl-btn-content">
                                                <span class="ctrl-btn-icon">⚙</span>
                                                <span>CONFIG</span>
                                            </div>
                                            <div class="ctrl-btn-corner tl"></div>
                                            <div class="ctrl-btn-corner tr"></div>
                                            <div class="ctrl-btn-corner bl"></div>
                                            <div class="ctrl-btn-corner br"></div>
                                        </button>
                                        
                                        <button class="ctrl-btn danger" onclick="resetAll()">
                                            <div class="ctrl-btn-leds">
                                                <div class="ctrl-btn-led green"></div>
                                                <div class="ctrl-btn-led orange"></div>
                                            </div>
                                            <div class="ctrl-btn-content">
                                                <span class="ctrl-btn-icon">↺</span>
                                                <span>RESET</span>
                                            </div>
                                            <div class="ctrl-btn-corner tl"></div>
                                            <div class="ctrl-btn-corner tr"></div>
                                            <div class="ctrl-btn-corner bl"></div>
                                            <div class="ctrl-btn-corner br"></div>
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Resume Disk Slot -->
                                <div class="disk-slot-panel">
                                    <div class="panel-title">RESUME DRIVE</div>
                                    <div class="disk-slot">
                                        <div class="disk-opening" onclick="triggerFileInput()">
                                            <div class="disk-empty" id="diskEmpty">INSERT DISK</div>
                                            <div class="disk-cassette" id="diskCassette">
                                                <span class="cassette-icon">💾</span>
                                                <div class="cassette-label">
                                                    <div class="cassette-name" id="cassetteName">RESUME.DOC</div>
                                                    <div class="cassette-size" id="cassetteSize">0 KB</div>
                                                </div>
                                                <span class="cassette-check">✓</span>
                                            </div>
                                        </div>
                                        
                                        <!-- Resume Info Card -->
                                        <div class="resume-info-card" id="resumeInfoCard">
                                            <div class="resume-info-header">
                                                <div class="resume-info-avatar">👤</div>
                                                <div class="resume-info-name">
                                                    <h4 id="resumeInfoName">Candidate</h4>
                                                    <p id="resumeInfoLevel">LEVEL: — | EXP: —</p>
                                                </div>
                                            </div>
                                            <div class="resume-info-stats">
                                                <div class="resume-stat">
                                                    <div class="resume-stat-value" id="resumeInfoExp">—</div>
                                                    <div class="resume-stat-label">YEARS EXP</div>
                                                </div>
                                                <div class="resume-stat">
                                                    <div class="resume-stat-value" id="resumeInfoSkillCount">—</div>
                                                    <div class="resume-stat-label">SKILLS</div>
                                                </div>
                                            </div>
                                            <div class="resume-skills" id="resumeInfoSkills"></div>
                                        </div>
                                        
                                        <div class="disk-leds">
                                            <div class="disk-led">
                                                <div class="disk-led-dot" id="ledReady"></div>
                                                <span class="disk-led-label green">READY</span>
                                            </div>
                                            <div class="disk-led">
                                                <div class="disk-led-dot" id="ledBusy"></div>
                                                <span class="disk-led-label orange">BUSY</span>
                                            </div>
                                        </div>
                                        
                                        <div class="disk-buttons">
                                            <button class="disk-btn insert" id="insertBtn" onclick="triggerFileInput()">↑ INSERT</button>
                                            <button class="disk-btn eject" id="ejectBtn" onclick="ejectDisk()" disabled>⏏ EJECT</button>
                                        </div>
                                        
                                        <div class="disk-hint" id="diskHint">INSERT RESUME DISK</div>
                                    </div>
                                    <input type="file" class="hidden-input" id="fileInput" accept=".txt,.pdf,.docx" onchange="uploadResume(this)">
                                </div>

                                <!-- Stats Panel -->
                                <div class="stats-panel">
                                    <div class="panel-title">SYSTEM STATUS</div>
                                    <div class="stats-list">
                                        <div class="stat-item">
                                            <div class="stat-item-left">
                                                <span class="stat-item-icon">📊</span>
                                                <span class="stat-item-label">SUITABLE</span>
                                            </div>
                                            <span class="stat-item-value" id="statSuitable">0</span>
                                        </div>
                                        <div class="stat-item">
                                            <div class="stat-item-left">
                                                <span class="stat-item-icon">⏳</span>
                                                <span class="stat-item-label">PENDING</span>
                                            </div>
                                            <span class="stat-item-value" id="statPending">0</span>
                                        </div>
                                        <div class="stat-item">
                                            <div class="stat-item-left">
                                                <span class="stat-item-icon">📈</span>
                                                <span class="stat-item-label">MATCH AVG</span>
                                            </div>
                                            <span class="stat-item-value" id="statMatchAvg">0%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal -->
    <div class="modal-backdrop" id="modal" onclick="closeModal(event)">
        <div class="modal-window chrome-panel" onclick="event.stopPropagation()">
            <div class="chrome-panel-middle">
                <div class="chrome-panel-inner">
                    <div class="title-bar">
                        <div class="title-bar-content">
                            <div style="display: flex; align-items: center;">
                                <div class="led green"></div>
                                <span class="title-text" style="margin-left: 12px;" id="modalTitle">VACANCY DETAILS</span>
                            </div>
                            <button class="win-btn close" onclick="closeModal()">×</button>
                        </div>
                    </div>
                    
                    <div class="modal-tabs">
                        <button class="modal-tab active" onclick="switchTab('details')">📋 DETAILS</button>
                        <button class="modal-tab" onclick="switchTab('analysis')">🤖 ANALYSIS</button>
                        <button class="modal-tab" onclick="switchTab('resume')" id="resumeTab" style="display: none;">📄 RESUME+</button>
                    </div>
                    
                    <div class="modal-body">
                        <div id="tabDetails" class="tab-content active"></div>
                        <div id="tabAnalysis" class="tab-content"></div>
                        <div id="tabResume" class="tab-content">
                            <button class="ctrl-btn" id="improveBtn" style="margin-bottom: 16px;" onclick="improveResume()">
                                <div class="ctrl-btn-content">
                                    <span class="ctrl-btn-icon">✨</span>
                                    <span>GENERATE IMPROVED RESUME</span>
                                </div>
                            </button>
                            <div class="stream-output" id="streamImprove"></div>
                            <div id="resumeComparison"></div>
                        </div>
                    </div>
                    
                    <div class="modal-actions">
                        <button class="modal-btn" onclick="closeModal()">CLOSE</button>
                        <button class="modal-btn primary" id="applyBtn">APPLY NOW</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal-backdrop" id="settingsModal" onclick="closeSettingsModal(event)">
        <div class="modal-window chrome-panel" onclick="event.stopPropagation()" style="max-width: 900px;">
            <div class="chrome-panel-middle">
                <div class="chrome-panel-inner">
                    <div class="title-bar">
                        <div class="title-bar-content">
                            <div class="title-leds">
                                <div class="led green"></div>
                                <div class="led orange"></div>
                                <div class="led blue"></div>
                            </div>
                            <span class="title-text" style="margin-left: 12px;">⚙ CONFIGURATION</span>
                            <div class="window-controls" style="margin-left: auto;">
                                <button class="win-btn close" onclick="closeSettingsModal()">×</button>
                            </div>
                        </div>
                    </div>

                    <div class="modal-body" style="padding: 30px;">
                        <!-- Model & Days -->
                        <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 24px;">
                            <div class="form-group">
                                <label class="form-label">AI MODEL</label>
                                <select class="form-select" id="modelSelect">
                                    <option value="mistral">Mistral 7B</option>
                                    <option value="gemini">Gemini API</option>
                                    <option value="ollama">Ollama</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">DAYS BACK</label>
                                <select class="form-select" id="daysSelect">
                                    <option value="1">1 day</option>
                                    <option value="3">3 days</option>
                                    <option value="7" selected>7 days</option>
                                    <option value="14">14 days</option>
                                    <option value="30">30 days</option>
                                </select>
                            </div>
                        </div>

                        <!-- Filter Criteria -->
                        <div style="margin-bottom: 24px;">
                            <label class="form-label">FILTER CRITERIA</label>
                            <div class="prompt-hint">💡 Empty = all vacancies accepted</div>
                            <textarea class="prompt-area" id="searchPrompt" placeholder="Looking for:
✅ Unreal Engine developer (junior, middle)
✅ C++ developer in gamedev
✅ Game programmer

NOT suitable:
❌ Senior positions (3+ years exp)
❌ Unity-only without Unreal
❌ Managers, HR, artists"></textarea>
                        </div>

                        <!-- Telegram Channels -->
                        <div>
                            <label class="form-label">TELEGRAM CHANNELS</label>
                            <div class="prompt-hint">📡 List of channels to monitor</div>

                            <div id="channelsList" style="margin-top: 12px; display: flex; flex-direction: column; gap: 8px;">
                                <!-- Channels will be added dynamically -->
                            </div>

                            <div style="margin-top: 12px; display: flex; gap: 8px;">
                                <input
                                    type="text"
                                    id="newChannelInput"
                                    class="form-select"
                                    placeholder="@channel or t.me/channel or -100123456"
                                    style="flex: 1;"
                                    onkeypress="if(event.key==='Enter') addChannel()"
                                >
                                <button class="ctrl-btn" onclick="addChannel()" style="width: auto; padding: 0 20px;">
                                    <div class="ctrl-btn-content">
                                        <span class="ctrl-btn-icon">+</span>
                                        <span>ADD</span>
                                    </div>
                                </button>
                            </div>
                            <div class="prompt-hint" style="margin-top: 8px; color: #ff6060;">⚠️ If list is empty, scan won't start!</div>
                        </div>
                    </div>

                    <div class="modal-actions">
                        <button class="modal-btn" onclick="closeSettingsModal()">CANCEL</button>
                        <button class="modal-btn primary" onclick="saveSettingsAndClose()">SAVE</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============== STATE ==============
        let isScanning = false;
        let ws = null;
        let vacancies = [];
        let currentVacancy = null;
        let resumeData = null;
        const improvementTasks = {};
        
        // ============== INIT ==============
        document.addEventListener('DOMContentLoaded', () => {
            initVUMeter();
            updateClock();
            setInterval(updateClock, 1000);
            initSystemMonitor();
            restoreSession();
            loadVacancies();
            connectWS();
        });
        
        function updateClock() {
            const now = new Date();
            document.getElementById('lcdTime').textContent = now.toLocaleTimeString('en-US', { hour12: false });
        }
        
        function initVUMeter() {
            const container = document.getElementById('vuSegments');
            for (let i = 0; i < 24; i++) {
                const seg = document.createElement('div');
                seg.className = 'vu-segment';
                if (i < 14) seg.classList.add('green');
                else if (i < 20) seg.classList.add('yellow');
                else seg.classList.add('red');
                container.appendChild(seg);
            }
        }
        
        function updateVUMeter(percent) {
            percent = Math.max(0, Math.min(100, percent || 0));
            
            const segments = document.querySelectorAll('.vu-segment');
            const needle = document.getElementById('vuNeedle');
            const container = document.getElementById('vuSegments');
            const valueEl = document.getElementById('vuValue');
            
            if (!segments.length) return;
            
            const totalSegments = segments.length;
            const activeCount = Math.floor((percent / 100) * totalSegments);
            
            // 1. Обновляем сегменты
            for (let i = 0; i < totalSegments; i++) {
                if (i < activeCount) {
                    segments[i].classList.add('active');
                } else {
                    segments[i].classList.remove('active');
                }
            }
            
            // 2. Needle позиция = процент активных сегментов (как в Figma React)
            // left: calc(${(activeSegments / segments) * 100}% - 1px)
            if (needle) {
                const needlePercent = (activeCount / totalSegments) * 100;
                needle.style.left = `calc(${needlePercent}% - 1px)`;
            }
            
            // 3. Обновляем текст
            if (valueEl) {
                valueEl.textContent = Math.round(percent) + '%';
            }
        }
        
        // ============== SYSTEM MONITOR (VU Meter) ==============
        let monitorInterval = null;
        let hasRealGPU = false;
        let fallbackMode = false;
        let cpuSamples = [];
        
        async function initSystemMonitor() {
            try {
                // Пробуем получить данные от backend
                const res = await fetch('/api/system-monitor');
                const data = await res.json();
                
                if (data.has_gpu && data.gpu) {
                    // Есть NVIDIA GPU с pynvml
                    hasRealGPU = true;
                    document.getElementById('vuDeviceName').textContent = data.gpu.short_name || 'GPU';
                    document.getElementById('vuDevice').classList.add('gpu');
                    document.querySelector('.vu-device-icon').textContent = '🎮';
                    console.log('Real GPU monitoring:', data.gpu.name);
                } else {
                    // CPU режим
                    hasRealGPU = false;
                    document.getElementById('vuDeviceName').textContent = 'CPU';
                    document.getElementById('vuDevice').classList.remove('gpu');
                    document.querySelector('.vu-device-icon').textContent = '💻';
                    console.log('CPU monitoring mode');
                }
                
                // Запускаем мониторинг через backend
                await fetch('/api/monitor/start', { method: 'POST' });
                fallbackMode = false;
                
            } catch (e) {
                console.log('Backend monitor unavailable, using fallback:', e);
                fallbackMode = true;
                detectGPUFallback();
                startFallbackMonitor();
            }
        }
        
        function detectGPUFallback() {
            // Фоллбэк через WebGL если backend недоступен
            try {
                const canvas = document.createElement('canvas');
                const gl = canvas.getContext('webgl');
                if (gl) {
                    const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
                    if (debugInfo) {
                        const renderer = gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);
                        const gpuKeywords = ['nvidia', 'geforce', 'rtx', 'gtx', 'radeon', 'rx '];
                        if (gpuKeywords.some(kw => renderer.toLowerCase().includes(kw))) {
                            let shortName = 'GPU';
                            const match = renderer.match(/\b(RTX|GTX)\s*(\d{3,4})/i);
                            if (match) shortName = match[1].toUpperCase() + ' ' + match[2];
                            document.getElementById('vuDeviceName').textContent = shortName;
                            document.getElementById('vuDevice').classList.add('gpu');
                            document.querySelector('.vu-device-icon').textContent = '🎮';
                            return;
                        }
                    }
                }
            } catch (e) {}
            document.getElementById('vuDeviceName').textContent = 'CPU';
        }
        
        function startFallbackMonitor() {
            // Фоллбэк измерение через requestAnimationFrame
            let lastTime = performance.now();
            
            function measure() {
                const now = performance.now();
                const delta = now - lastTime;
                lastTime = now;
                
                const load = Math.min(100, Math.max(0, ((delta - 16.67) / 16.67) * 100 + 15));
                cpuSamples.push(load);
                if (cpuSamples.length > 20) cpuSamples.shift();
                
                const avg = cpuSamples.reduce((a, b) => a + b, 0) / cpuSamples.length;
                updateVUMeter(avg);
                
                if (fallbackMode) requestAnimationFrame(measure);
            }
            requestAnimationFrame(measure);
        }
        
        function handleSystemMonitor(data) {
            // Обработка данных мониторинга от WebSocket
            if (data.has_gpu && data.gpu && typeof data.gpu.utilization === 'number') {
                updateVUMeter(data.gpu.utilization);
                
                // Обновляем tooltip с деталями
                const tooltip = `${data.gpu.name}\nGPU: ${data.gpu.utilization}%\nVRAM: ${data.gpu.memory_used_mb}/${data.gpu.memory_total_mb} MB\nTemp: ${data.gpu.temperature}°C`;
                document.querySelector('.vu-panel').title = tooltip;
            } else if (data.cpu && typeof data.cpu.utilization === 'number') {
                updateVUMeter(data.cpu.utilization);
                
                const tooltip = `CPU: ${data.cpu.utilization}%\nCores: ${data.cpu.cores}\nRAM: ${data.cpu.memory_used_gb}/${data.cpu.memory_total_gb} GB`;
                document.querySelector('.vu-panel').title = tooltip;
            }
        }
        
        // ============== SESSION ==============
        async function restoreSession() {
            try {
                const res = await fetch('/api/session');
                const data = await res.json();
                
                if (data.settings) {
                    document.getElementById('modelSelect').value = data.settings.model_type || 'mistral';
                    document.getElementById('daysSelect').value = data.settings.days_back || 7;
                    if (data.settings.custom_prompt) {
                        document.getElementById('searchPrompt').value = data.settings.custom_prompt;
                    }
                    if (data.settings.channels && data.settings.channels.length > 0) {
                        channels = data.settings.channels;
                    }
                }
                
                if (data.resume_data) {
                    resumeData = data.resume_data;
                    showResumeInserted(data.resume_data, false); // без анимации при восстановлении
                }
                
                if (data.stats) {
                    updateStatsDisplay(data.stats);
                }
                
                if (data.is_monitoring) {
                    isScanning = true;
                    updateScanButton(true);
                }
            } catch (e) {
                console.error('Session restore error:', e);
            }
        }
        
        async function loadVacancies() {
            try {
                const res = await fetch('/api/vacancies');
                const data = await res.json();
                if (data.vacancies && data.vacancies.length) {
                    data.vacancies.forEach(v => addVacancy(v, false));
                }
            } catch (e) {
                console.error('Load vacancies error:', e);
            }
        }
        
        // ============== WEBSOCKET ==============
        function connectWS() {
            if (ws && ws.readyState === WebSocket.OPEN) return;
            
            ws = new WebSocket(`ws://${window.location.host}/ws`);
            ws.onopen = () => console.log('WS connected');
            ws.onmessage = (e) => handleWSMessage(JSON.parse(e.data));
            ws.onclose = () => { if (isScanning) setTimeout(connectWS, 2000); };
        }
        
        function handleWSMessage(data) {
            switch (data.type) {
                case 'vacancy':
                    addVacancy(data.vacancy);
                    break;
                case 'status':
                    document.getElementById('lcdMessage').textContent = data.message;
                    break;
                case 'stats':
                    updateStatsDisplay(data.stats);
                    break;
                case 'progress':
                    document.getElementById('progressBar').style.width = data.percent + '%';
                    break;
                case 'stream':
                    handleStream(data);
                    break;
                case 'resume_improved':
                    handleResumeImproved(data);
                    break;
                case 'system_monitor':
                    handleSystemMonitor(data);
                    break;
            }
        }
        
        function updateStatsDisplay(stats) {
            if (stats.found !== undefined) 
                document.getElementById('lcdFound').textContent = String(stats.found).padStart(3, '0');
            if (stats.processed !== undefined) 
                document.getElementById('lcdProcessed').textContent = String(stats.processed).padStart(3, '0');
            if (stats.rejected !== undefined) 
                document.getElementById('lcdRejected').textContent = String(stats.rejected).padStart(3, '0');
            if (stats.suitable !== undefined)
                document.getElementById('statSuitable').textContent = stats.suitable;
        }
        
        // ============== RESUME ==============
        function triggerFileInput() {
            document.getElementById('fileInput').click();
        }
        
        async function uploadResume(input) {
            if (!input.files || !input.files[0]) return;
            
            const file = input.files[0];
            showResumeLoading(file.name, file.size);
            
            try {
                const text = await file.text();
                const model = document.getElementById('modelSelect').value;
                
                const res = await fetch(`/api/upload-resume?model_type=${model}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/octet-stream'},
                    body: text
                });
                
                const result = await res.json();
                
                if (result.error) {
                    alert('Error: ' + result.error);
                    hideResumeLoading();
                } else {
                    resumeData = result;
                    resumeData.raw_text = text;
                    showResumeInserted(result, true);
                }
            } catch (e) {
                alert('Upload failed');
                hideResumeLoading();
            }
        }
        
        function showResumeLoading(fileName, fileSize) {
            document.getElementById('ledBusy').classList.add('active', 'orange');
            document.getElementById('diskEmpty').style.display = 'none';
            document.getElementById('diskHint').textContent = 'ANALYZING...';
            
            // Показываем кассету в процессе вставки
            const cassette = document.getElementById('diskCassette');
            document.getElementById('cassetteName').textContent = fileName || 'RESUME.DOC';
            document.getElementById('cassetteSize').textContent = formatFileSize(fileSize || 0);
            cassette.classList.remove('inserted', 'ejecting');
            cassette.classList.add('inserting');
        }
        
        function hideResumeLoading() {
            document.getElementById('ledBusy').classList.remove('active', 'orange');
            document.getElementById('diskEmpty').style.display = 'flex';
            document.getElementById('diskHint').textContent = 'INSERT RESUME DISK';
            
            const cassette = document.getElementById('diskCassette');
            cassette.classList.remove('inserting', 'inserted');
        }
        
        function showResumeInserted(data, animate = true) {
            document.getElementById('diskEmpty').style.display = 'none';
            document.getElementById('ledReady').classList.add('active', 'green');
            document.getElementById('ledBusy').classList.remove('active', 'orange');
            document.getElementById('insertBtn').disabled = true;
            document.getElementById('ejectBtn').disabled = false;
            document.getElementById('diskHint').textContent = 'DISK LOADED OK';
            
            // Кассета
            const cassette = document.getElementById('diskCassette');
            cassette.classList.remove('inserting', 'ejecting');
            if (animate) {
                // Ждем окончания анимации inserting
                setTimeout(() => {
                    cassette.classList.add('inserted');
                }, 800);
            } else {
                cassette.classList.add('inserted');
            }
            
            // Информация о резюме
            const infoCard = document.getElementById('resumeInfoCard');
            infoCard.classList.add('active');
            
            // Заполняем данные
            document.getElementById('resumeInfoName').textContent = data.name || 'Candidate';
            document.getElementById('resumeInfoLevel').textContent = 
                `LEVEL: ${(data.level || '—').toUpperCase()} | EXP: ${data.experience_years || '—'}y`;
            document.getElementById('resumeInfoExp').textContent = data.experience_years || '—';
            
            const skills = data.key_skills || [];
            document.getElementById('resumeInfoSkillCount').textContent = skills.length;
            
            const skillsContainer = document.getElementById('resumeInfoSkills');
            skillsContainer.innerHTML = '';
            skills.slice(0, 6).forEach(skill => {
                const tag = document.createElement('span');
                tag.className = 'resume-skill-tag';
                tag.textContent = skill;
                skillsContainer.appendChild(tag);
            });
        }
        
        function ejectDisk() {
            const cassette = document.getElementById('diskCassette');
            cassette.classList.remove('inserted', 'inserting');
            cassette.classList.add('ejecting');
            
            // После анимации сбрасываем
            setTimeout(() => {
                resumeData = null;
                cassette.classList.remove('ejecting');
                document.getElementById('diskEmpty').style.display = 'flex';
                document.getElementById('ledReady').classList.remove('active', 'green');
                document.getElementById('insertBtn').disabled = false;
                document.getElementById('ejectBtn').disabled = true;
                document.getElementById('resumeInfoCard').classList.remove('active');
                document.getElementById('diskHint').textContent = 'INSERT RESUME DISK';
            }, 600);
        }
        
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }
        
        // ============== SCANNING ==============
        async function toggleScan() {
            if (!isScanning) {
                await saveSettings();
                const res = await fetch('/api/start', {method: 'POST'});
                const data = await res.json();
                
                if (data.status === 'started' || data.status === 'already_running') {
                    isScanning = true;
                    updateScanButton(true);
                    connectWS();
                }
            } else {
                await fetch('/api/stop', {method: 'POST'});
                isScanning = false;
                updateScanButton(false);
            }
        }
        
        function updateScanButton(scanning) {
            const btn = document.getElementById('scanBtn');
            const dots = document.getElementById('scanningDots');
            const progress = document.getElementById('progressContainer');
            
            if (scanning) {
                btn.classList.add('active');
                btn.querySelector('.ctrl-btn-content span:last-child').textContent = 'STOP';
                btn.querySelector('.ctrl-btn-icon').textContent = '⏸';
                document.getElementById('lcdStatus').textContent = 'SCANNING';
                dots.style.display = 'flex';
                progress.style.display = 'block';
            } else {
                btn.classList.remove('active');
                btn.querySelector('.ctrl-btn-content span:last-child').textContent = 'SCAN';
                btn.querySelector('.ctrl-btn-icon').textContent = '▶';
                document.getElementById('lcdStatus').textContent = 'IDLE';
                dots.style.display = 'none';
                progress.style.display = 'none';
                updateVUMeter(0);
            }
        }
        
        async function saveSettings() {
            const settings = {
                model_type: document.getElementById('modelSelect').value,
                days_back: parseInt(document.getElementById('daysSelect').value),
                custom_prompt: document.getElementById('searchPrompt').value,
                channels: channels  // Используем глобальный массив каналов
            };

            await fetch('/api/settings', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(settings)
            });
        }
        
        function openSettings() {
            document.getElementById('settingsModal').classList.add('active');
            renderChannelsList();
        }

        function closeSettingsModal(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('settingsModal').classList.remove('active');
        }

        async function saveSettingsAndClose() {
            await saveSettings();
            closeSettingsModal();
        }

        // Управление каналами
        let channels = [];

        function addChannel() {
            const input = document.getElementById('newChannelInput');
            let channel = input.value.trim();

            if (!channel) return;

            // Очищаем от префиксов
            channel = channel.replace(/^@/, '');
            channel = channel.replace(/^https?:\/\/t\.me\//, '');
            channel = channel.replace(/^t\.me\//, '');
            channel = channel.trim();

            if (!channel) return;

            // Проверяем дубликаты
            if (channels.includes(channel)) {
                alert('This channel is already added');
                return;
            }

            channels.push(channel);
            input.value = '';
            renderChannelsList();
        }

        function removeChannel(index) {
            channels.splice(index, 1);
            renderChannelsList();
        }

        function renderChannelsList() {
            const container = document.getElementById('channelsList');
            if (!container) return;

            if (channels.length === 0) {
                container.innerHTML = '<div class="prompt-hint" style="text-align: center; padding: 20px; opacity: 0.5;">List is empty. Add channels below.</div>';
                return;
            }

            container.innerHTML = channels.map((ch, idx) => `
                <div style="display: flex; align-items: center; gap: 8px; padding: 10px 14px; background: rgba(26, 26, 32, 0.5); border: 2px solid var(--border-dark); border-radius: 8px;">
                    <span style="flex: 1; font-family: 'Share Tech Mono', monospace; color: #7dff7d;">
                        ${ch.startsWith('-') ? ch : '@' + ch}
                    </span>
                    <button onclick="removeChannel(${idx})" style="
                        background: linear-gradient(180deg, #8a4040, #6a3030);
                        border: 2px solid;
                        border-color: #9a5050 #5a2020 #5a2020 #9a5050;
                        border-radius: 6px;
                        color: #ff6060;
                        cursor: pointer;
                        padding: 6px 12px;
                        font-family: 'Share Tech Mono', monospace;
                        font-size: 12px;
                        font-weight: bold;
                    ">
                        ×
                    </button>
                </div>
            `).join('');
        }
        
        async function resetAll() {
            if (!confirm('Reset all data?')) return;
            await fetch('/api/reset', {method: 'POST'});
            vacancies = [];
            document.getElementById('vacanciesGrid').innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">📡</div>
                    <div class="empty-state-text">AWAITING SIGNAL...<br>PRESS SCAN TO BEGIN</div>
                </div>
            `;
            document.getElementById('vacancyCount').textContent = '0';
            updateStatsDisplay({found: 0, processed: 0, rejected: 0, suitable: 0});
        }
        
        // ============== VACANCIES ==============
        function addVacancy(vacancy, animate = true) {
            const grid = document.getElementById('vacanciesGrid');
            const empty = grid.querySelector('.empty-state');
            if (empty) empty.remove();
            
            if (vacancies.find(v => v.id === vacancy.id)) return;
            vacancies.unshift(vacancy);
            
            const card = createVacancyCard(vacancy);
            grid.insertBefore(card, grid.firstChild);
            
            document.getElementById('vacancyCount').textContent = vacancies.length;
        }
        
        function createVacancyCard(v) {
            const card = document.createElement('div');
            card.className = 'vacancy-card';
            card.id = 'card_' + v.id;
            
            const info = extractInfo(v);
            
            // Match Rate логика:
            // - Если есть comparison (после улучшения резюме) -> показываем реальный score
            // - Если нет comparison -> скрываем или показываем N/A
            const hasComparison = v.comparison && typeof v.comparison.match_score === 'number';
            const match = hasComparison ? v.comparison.match_score : null;
            const matchClass = match !== null ? (match >= 90 ? 'high' : match >= 70 ? 'medium' : 'low') : 'none';
            
            // Match meter HTML - показываем только если есть данные
            const matchMeterHTML = match !== null ? `
                <div class="match-meter">
                    <div class="match-meter-header">
                        <div class="match-meter-label">
                            <span class="match-meter-icon">📈</span>
                            <span>MATCH RATE</span>
                        </div>
                        <span class="match-meter-value ${matchClass}">${match}%</span>
                    </div>
                    <div class="match-meter-bar">
                        <div class="match-meter-fill ${matchClass}" style="width: ${match}%;"></div>
                    </div>
                </div>
            ` : `
                <div class="match-meter pending">
                    <div class="match-meter-header">
                        <div class="match-meter-label">
                            <span class="match-meter-icon">📈</span>
                            <span>MATCH RATE</span>
                        </div>
                        <span class="match-meter-value none">—</span>
                    </div>
                    <div class="match-meter-hint">Click RESUME+ to analyze</div>
                </div>
            `;
            
            card.innerHTML = `
                <div class="vacancy-card-header">
                    <div class="vacancy-card-id">
                        <div class="vacancy-card-led active"></div>
                        <span class="vacancy-card-code">${escapeHtml(v.channel?.substring(0, 15) || 'VAC')}</span>
                    </div>
                    <span class="vacancy-card-status">ACTIVE</span>
                </div>
                <div class="vacancy-card-body">
                    <div class="vacancy-card-title">${escapeHtml(info.position || 'Vacancy')}</div>
                    <div class="vacancy-card-company">${escapeHtml(v.channel || '')}</div>
                    <div class="vacancy-card-details">
                        ${info.conditions ? `<div class="vacancy-card-detail"><span class="vacancy-card-detail-icon">💰</span><span class="vacancy-card-detail-text">${escapeHtml(info.conditions)}</span></div>` : ''}
                        <div class="vacancy-card-detail"><span class="vacancy-card-detail-icon">📅</span><span class="vacancy-card-detail-text">${formatDate(v.date)}</span></div>
                    </div>
                    ${matchMeterHTML}
                    <div class="vacancy-card-actions">
                        <button class="vacancy-btn details" onclick="showDetails('${v.id}')">📋 DETAILS</button>
                        ${v.link ? `<a class="vacancy-btn open" href="${v.link}" target="_blank">🔗 OPEN</a>` : `<button class="vacancy-btn open" disabled>🔗 OPEN</button>`}
                    </div>
                </div>
                <div class="vacancy-card-footer"></div>
            `;
            
            return card;
        }
        
        function extractInfo(v) {
            const text = v.text || '';
            const info = {position: '', conditions: ''};
            
            const lines = text.split('\n').filter(l => l.trim());
            if (lines.length) info.position = lines[0].substring(0, 50);
            
            const cond = text.match(/(от\s*\d+|до\s*\d+|\d+\s*(руб|usd|eur|k)|удаленн|офис|гибрид)/gi);
            if (cond) info.conditions = cond.slice(0, 2).join(' • ');
            
            return info;
        }
        
        // ============== MODAL ==============
        function showDetails(id) {
            currentVacancy = vacancies.find(v => v.id === id);
            if (!currentVacancy) return;
            
            document.getElementById('modalTitle').textContent = 'VACANCY :: ' + (currentVacancy.channel || '').substring(0, 20);
            
            document.getElementById('tabDetails').innerHTML = `
                <div style="font-family: var(--font-main); font-size: var(--font-size-sm); color: #c0c8d0; line-height: 1.7; white-space: pre-wrap;">
                    ${escapeHtml(currentVacancy.text)}
                </div>
            `;
            
            document.getElementById('tabAnalysis').innerHTML = currentVacancy.analysis ? `
                <div style="padding: 16px; background: linear-gradient(180deg, #1a2a2a, #0a1a1a); border: 2px solid #3a5050; border-radius: 8px;">
                    <div style="font-size: var(--font-size-sm); color: #7dff7d; letter-spacing: 1px; margin-bottom: 12px;">🤖 AI ANALYSIS</div>
                    <div style="font-size: var(--font-size-sm); color: #c0c8d0; line-height: 1.6;">${formatAnalysis(currentVacancy.analysis)}</div>
                </div>
            ` : '<div style="color: #5a6070;">No analysis available</div>';
            
            document.getElementById('resumeTab').style.display = resumeData ? 'block' : 'none';
            document.getElementById('resumeComparison').innerHTML = '';
            document.getElementById('improveBtn').style.display = 'block';
            document.getElementById('streamImprove').classList.remove('active');
            
            if (currentVacancy.link) {
                document.getElementById('applyBtn').onclick = () => window.open(currentVacancy.link, '_blank');
            }
            
            switchTab('details');
            document.getElementById('modal').classList.add('active');
        }
        
        function closeModal(e) {
            if (!e || e.target === e.currentTarget) {
                document.getElementById('modal').classList.remove('active');
            }
        }
        
        function switchTab(tab) {
            document.querySelectorAll('.modal-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            document.querySelector(`.modal-tab[onclick="switchTab('${tab}')"]`).classList.add('active');
            document.getElementById('tab' + tab.charAt(0).toUpperCase() + tab.slice(1)).classList.add('active');
        }
        
        async function improveResume() {
            if (!currentVacancy || !resumeData) return;
            
            const btn = document.getElementById('improveBtn');
            const stream = document.getElementById('streamImprove');
            
            btn.style.display = 'none';
            stream.classList.add('active');
            stream.textContent = 'Generating...';
            
            try {
                const res = await fetch('/api/improve-resume', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        vacancy_text: currentVacancy.text,
                        vacancy_title: currentVacancy.channel,
                        vacancy_id: currentVacancy.id
                    })
                });
                
                await res.json();
            } catch (e) {
                stream.textContent = 'Error: ' + e;
                btn.style.display = 'block';
            }
        }
        
        function handleStream(data) {
            if (data.stream_type === 'comparison' || data.stream_type === 'improve_resume') {
                const el = document.getElementById('streamImprove');
                if (el && data.chunk && !['[START]', '[END]'].includes(data.chunk)) {
                    if (el.textContent === 'Generating...') el.textContent = '';
                    el.textContent += data.chunk;
                    el.scrollTop = el.scrollHeight;
                }
            }
        }
        
        function handleResumeImproved(data) {
            const stream = document.getElementById('streamImprove');
            const comp = document.getElementById('resumeComparison');
            
            stream.classList.remove('active');
            
            if (data.error) {
                document.getElementById('improveBtn').style.display = 'block';
                return;
            }
            
            comp.innerHTML = `
                <div class="resume-compare">
                    <div class="resume-column original">
                        <div class="resume-column-header">📄 ORIGINAL RESUME</div>
                        <div class="resume-column-body">${escapeHtml(resumeData.raw_text || '')}</div>
                    </div>
                    <div class="resume-column improved">
                        <div class="resume-column-header">✨ IMPROVED (${data.result?.match_score || 0}% MATCH)</div>
                        <div class="resume-column-body">${escapeHtml(data.result?.improved_resume || 'No improved resume')}</div>
                    </div>
                </div>
            `;
        }
        
        // ============== UTILS ==============
        function escapeHtml(t) {
            if (!t) return '';
            const d = document.createElement('div');
            d.textContent = t;
            return d.innerHTML;
        }
        
        function formatDate(d) {
            if (!d) return '';
            return new Date(d).toLocaleDateString('ru-RU', {day: 'numeric', month: 'short'});
        }
        
        function formatAnalysis(t) {
            return escapeHtml(t).replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>');
        }
    </script>

    <!-- Подключаем модуль авторизации Telegram -->
    <link rel="stylesheet" href="/static/auth.css">
    <script src="/static/auth.js"></script>
</body>
</html>
